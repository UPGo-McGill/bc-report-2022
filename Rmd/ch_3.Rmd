---
title: "Chapter 3. Community case studies"
date: '2022-05-28'
output: pdf_document
---

```{r setup, include=FALSE}

knitr::opts_chunk$set(echo = FALSE)
knitr::opts_chunk$set(eval = FALSE)
knitr::opts_chunk$set(message = FALSE)
knitr::opts_chunk$set(warning = FALSE)

library(tidyverse)
library(sf)
library(slider)
library(patchwork)

qs::qload(here::here("output/data/ch_3.qsm"))
# qs::qload(here::here("output/data/geometry.qsm"))
# qs::qload(here::here("output/data/model_chapter.qsm"))

col_palette <-
  c("#B8D6BE", "#73AE80", "#B5C0DA", "#6C83B5", "#2A5A5B", "#B58A6C", "#5B362A",
    "#AE7673")

```

## Case studies

The preceding analysis has been carried out for the entire province of British Columbia, subdivided into five community types (central cities, non-central-city large urban regions, mid-sized cities, resort towns, and non-urban areas). In order to provide a more nuanced picture of the impacts of STRs on BC communities, we now present a series of case studies, one taken from each of these community types. The case studies are identified in Figure 13.

```{r fig_13, fig.width = 9}

case_studies <- c("Vancouver", "Richmond", "Nanaimo", "Kelowna", "Summerland")

CSD |> 
  filter(name %in% case_studies) |> 
  ggplot() +
  geom_sf(data = CSD, colour = "transparent", fill = "grey80") +
  geom_sf(fill = "grey20", colour = "white", lwd = 0.2) +
  geom_sf(data = water, fill = "white", colour = "transparent") +
  ggrepel::geom_label_repel(aes(label = name, geometry = geometry), stat = "sf_coordinates", 
                            nudge_x = c(-50000, 50000, 50000, -50000, 50000),
                            nudge_y = c(50000, -50000, 50000, 50000, 50000)) +
  coord_sf(xlim = st_bbox(filter(CSD, name %in% case_studies))[c(1, 3)] * c(0.8, 1.1),
           ylim = c(st_bbox(CSD)[2], 
                    st_bbox(filter(CSD, name %in% case_studies))[c(4)] * 1.05)) +
  theme_void()

```

## Vancouver

The city of Vancouver (population 662,000) is the largest city in British Columbia and the centre of the 2.6-million person Metro Vancouver region. It is also a pioneer in STR regulations in Canada, having introduced mandatory STR licensing and principal-residence-only restrictions in 2018. We previously conducted an evaluation of these regulations at the City's request (Wachsmuth et al. 2021), and we draw in part on those findings in what follows.

In April 2022 there were an average of `r active_apr_2022_V` active STR listings in Vancouver each day (a `r active_change_2021_2022_V` year-over-year increase from April 2021, although still far lower than the `r active_avg_2019_V` active in 2019). Over the course of 2021, Vancouver's STR listings were operated by `r hosts_avg_2021_V` hosts (compared to `r hosts_avg_2019_V` in 2019), who collectively earned `r rev_total_2021_V` in revenue (just half the `r rev_total_2019_V` in 2019), with an average of `r rev_avg_2021_V` per listing (compared to `r rev_avg_2019_V` in 2019) and a median of `r rev_med_2021_V` (compared to `r rev_med_2019_V` in 2019).

Figure 14 displays the number of active listings per day in Vancouver, expressed as a percentage of all dwelling units. Prior to the implementation of its STR regulations, Vancouver had a much higher prevalence of STRs than Victoria or Abbotsford (the two other central cities shown in the "Central city average" line in the figure). The gap narrowed from mid-2018 through the beginning of the pandemic, and since late 2020 Vancouver's STR market has shrunken to be proportionately the same size as the other two cities'. Figure 15 shows the distribution of Vancouver's STRs in 2021, as actual locations in the left panel and as a share of dwelling units in the right panel.

```{r fig_14, echo = FALSE}

active_daily_V |> 
  ggplot() +
  geom_line(aes(date, n_pct, colour = group), lwd = 1.5) +
  scale_x_date(name = NULL) +
  scale_y_continuous(name = NULL, labels = scales::percent) +
  scale_colour_manual(name = NULL, values = c("grey30", "red"), 
                      na.value = "transparent") +
  ggtitle("Figure X. Active listings as % of all dwelling units") + 
  theme_minimal() +
  theme(legend.position = "bottom")

```

```{r fig_15, fig.width = 9}

fig_15_left <- 
  property_V |> 
  filter(created <= "2021-12-31", scraped >= "2021-01-01") |> 
  st_as_sf(coords = c("longitude", "latitude"), crs = 4326) |> 
  st_transform(32610) |> 
  ggplot() +
  geom_sf(data = CSD, colour = "transparent", fill = "grey80") +
  geom_sf(data = filter(CSD, name == "Vancouver"), fill = "grey90",
          colour = "transparent") +
  geom_sf(data = streets_V, colour = "#FFFFFF90") +
  geom_sf(data = streets_V_2, colour = "#FFFFFF80", lwd = 0.2) +
  geom_sf(data = water, fill = "white", colour = "transparent") +
  geom_sf(aes(colour = listing_type), size = 0.5) +
  coord_sf(xlim = st_bbox(filter(CSD, name == "Vancouver"))[c(1, 3)],
           ylim = st_bbox(filter(CSD, name == "Vancouver"))[c(2, 4)]) +
  scale_colour_discrete(name = NULL) +
  theme_void() +
  theme(legend.position = "bottom")

fig_15_right <- 
  CT |> 
  inner_join(listings_pct_V) |> 
  ggplot() +
  geom_sf(data = CSD, colour = "transparent", fill = "grey80") +
  geom_sf(data = filter(CSD, name == "Vancouver"), fill = "grey90", 
          colour = "transparent") +
  geom_sf(aes(fill = pct), colour = "white", size = 0.5) +
  geom_sf(data = streets_V, colour = "#FFFFFF90") +
  geom_sf(data = streets_V_2, colour = "#FFFFFF80", lwd = 0.2) +
  geom_sf(data = water, fill = "white", colour = "transparent") +
  scale_fill_viridis_b(name = "Active STR listings as % of dwelling units",
                       labels = scales::percent, n.breaks = 8, limits = c(0, 0.07)) +
  coord_sf(xlim = st_bbox(filter(CSD, name == "Vancouver"))[c(1, 3)],
           ylim = st_bbox(filter(CSD, name == "Vancouver"))[c(2, 4)]) +
  theme_void() +
  theme(legend.position = "bottom")

fig_15_left + fig_15_right + ggtitle("Figure 15. Active STR listings in Vancouver")

```

Since the pandemic, Vancouver's STR market has collapsed---along with neighbouring West Vancouver, Vancouver registered the largest proportionate decline in STR reservations between 2019 and 2021 of any mid-sized or large municipality in the province. As the left panel of Figure 16 demonstrates, STR reservations from March 2020 through April 2022 have been only `r covid_res_pct_V` of what would have been expected for this time period. At the same time, the right panel of Figure 16 shows that average nightly prices have been `r covid_price_pct_V` lower than the pre-pandemic trend. This combination of fewer reservations at lower prices demonstrates a collapse in STR demand in Vancouver, and is consistent with the pattern we have observed provincially, where international travel was cancelled and diverted to regional destinations, causing STR demand in the major cities to fall dramatically.

```{r fig_16, fig.width = 9}

p1 <- reservations_and_prices_V |> 
  mutate(res = slide_dbl(res, mean, .before = 6, .complete = TRUE)) |> 
  mutate(res_trend = if_else(date <= "2020-03-01", NA_real_, res_trend)) |> 
  select(date, res, res_trend) |> 
  pivot_longer(-c(date)) |> 
  filter(!is.na(value)) |> 
  mutate(label = case_when(
    date == "2019-07-05" & name == "res" ~ "Actual reservations", 
    date == "2020-08-05" & name == "res_trend" ~ "Expected reservations",
    TRUE ~ NA_character_)) |> 
  ggplot() +
  geom_ribbon(aes(x = date, ymin = res, ymax = res_trend, group = 1),
              data = {reservations_and_prices_V |> 
                  mutate(res = slider::slide_dbl(res, mean, .before = 6, .complete = TRUE)) |> 
                  mutate(res_trend = if_else(date <= "2020-03-01", NA_real_, res_trend))
                }, fill = col_palette[3],
              alpha = 0.3) +
  geom_line(aes(date, value, color = name), lwd = 1) +
  geom_label(aes(date, value, label = label, color = name), size = 3) +
  scale_x_date(name = NULL, limits = as.Date(c("2018-01-01", NA))) +
  scale_y_continuous(name = NULL, limits = c(0, NA), 
                     label = scales::comma) +
  scale_color_manual(name = NULL, 
                     labels = c("Actual reservations", "Expected reservations"), 
                     values = col_palette[c(5, 1)]) +
  theme_minimal() +
  theme(legend.position = "none",
        panel.grid.minor.x = element_blank(),
        plot.background = element_rect(fill = "white", colour = "transparent"))

p2 <- reservations_and_prices_V |> 
  mutate(price = slide_dbl(price, mean, .before = 6, .complete = TRUE)) |> 
  select(date, price, price_trend) |> 
  pivot_longer(-c(date)) |> 
  filter(!is.na(value)) |> 
  mutate(label = case_when(
    date == "2019-07-05" & name == "price" ~ "Actual price", 
    date == "2021-02-01" & name == "price_trend" ~ "Expected price",
    TRUE ~ NA_character_)) |> 
  ggplot() +
  geom_ribbon(aes(x = date, ymin = price, ymax = price_trend, group = 1),
              data = {reservations_and_prices_V |> 
                  mutate(price = slider::slide_dbl(price, mean, .before = 6, 
                                                   .complete = TRUE))}, 
              fill = col_palette[3],
              alpha = 0.3) +
  geom_line(aes(date, value, color = name), lwd = 1) +
  geom_label(aes(date, value, label = label, color = name), size = 3) +
  scale_x_date(name = NULL, limits = as.Date(c("2018-01-01", NA))) +
  scale_y_continuous(name = NULL, label = scales::dollar) +
  scale_color_manual(name = NULL, 
                     labels = c("Actual price", "Expected price"), 
                     values = col_palette[c(5, 1)]) +
  theme_minimal() +
  theme(legend.position = "none",
        panel.grid.minor.x = element_blank(),
        plot.background = element_rect(fill = "white", colour = "transparent"))

p1 + p2

```

Despite Vancouver's STR regulations having somewhat reduced the dominance of commercial operators, the city's STR market remains mostly dedicated STRs. On average from 2018-20222, `r commercial_pct_V` of listings active each day in Vancouver have been frequently rented entire-home listings or ghost hostels, which means they are highly unlikely to be the host's principal residence. Figure 17 shows the total amount of STR-induced housing loss in Vancouver, and demonstrates that, in the absence of the pandemic, there could be 2500 or more housing units operating as full-time STRs in the city.

```{r fig_17, fig.width = 9}

dat <- 
  housing_loss_daily_model_V |> 
  mutate(units_trend = slide_dbl(units_trend, mean, .before = 6, .complete = TRUE)) |>
  select(date, units, units_trend) |> 
  filter(date <= "2022-03-31")

dat |> 
  pivot_longer(-c(date)) |> 
  filter(!is.na(value)) |> 
  mutate(label = case_when(
    date == "2019-05-05" & name == "units" ~ "Actual housing loss", 
    date == "2020-03-07" & name == "units_trend" ~ "Expected housing loss",
    TRUE ~ NA_character_)) |> 
  ggplot() +
  geom_ribbon(aes(x = date, ymin = units, ymax = units_trend, group = 1),
              data = dat, fill = col_palette[3], alpha = 0.3) +
  geom_line(aes(date, value, color = name), lwd = 1) +
  geom_label(aes(date, value, label = label, color = name), size = 3) +
  scale_x_date(name = NULL, limits = as.Date(c("2018-01-01", NA))) +
  scale_y_continuous(name = NULL, limits = c(0, NA), 
                     label = scales::comma) +
  scale_color_manual(name = NULL, 
                     labels = c("Actual STR housing loss", 
                                "Expected STR housing loss"), 
                     values = col_palette[c(5, 1)]) +
  theme_minimal() +
  theme(legend.position = "none",
        panel.grid.minor.x = element_blank(),
        plot.background = element_rect(fill = "white", colour = "transparent"))

```

From 2016-2021, our province-wide model suggests that renters in Vancouver paid `r overpaid_2016_2021_V` more in rent because of the presence of commercial STRs driving up rents. In 2019, when the STR market was at its pre-pandemic peak, we estimate dedicated STRs were responsible for `r rent_str_pct_2019_V` of the total rents paid by Vacouver tenants. Put differently, during the 2017-2019 pre-pandemic period, the increase of dedicated STRs in Vancouver accounts for `r str_incr_2017_2019_V` of the increases in rents which Richmond households were subjected to. The average Vancouver neighbourhood saw a `r rent_month_2017_2019_V` increase in monthly rent each of these years, of which `r str_incr_month_2017_2019_V` can be attributed to the growth of dedicated STRs. This number is much lower than most other communities in British Columbia, and reflects the effectiveness of the City of Vancouver's restrictions on commercial STRs. By limiting (with partial success from an enforcement perspective) STRs to a host's principal residence, the City of Vancouver has kept the number of commercial STRs much lower than it otherwise would have been, and kept rents from rising even higher than they otherwise would have.

In a more dramatic example of the impact of declining STR activity on housing affordability, in 2020, when the number of commercial STRs plummeted because of the pandemic, we estimate that rents in Vancouver increased `r str_incr_2020_V` less than they otherwise would have, because of the decrease in commercial STRs that year. In our previous work, we in fact identified 1,148 Airbnb and Vrbo listings which were relisted on the long-term market via Craigslist or Kijiji between March and September of 2020 (Wachsmuth et al. 2021). We identified these listings through custom image matching software which we developed; a pair of examples are shown in Figure 18. These listings were disproportionately commercial STRs in downtown Vancouver whose hosts had been earning more than twice the city-wide average in STR revenue prior to the pandemic.

```{r fig_18}

library(imager)

pmap(list(list(first_photo_pair$x_name, first_photo_pair$y_name, 
               second_photo_pair$x_name, second_photo_pair$y_name), 
          titles, c("A", "B", "C", "D")), 
     ~{.x |>  
         load.image() |> 
         as.data.frame(wide = "c") |> 
         mutate(rgb = rgb(c.1, c.2, c.3)) |> 
         ggplot(aes(x, y)) +
         geom_raster(aes(fill = rgb)) + 
         scale_fill_identity() +
         scale_y_continuous(trans = scales::reverse_trans()) +
         ggtitle(paste0(..3, ". ", case_when(
           str_detect(..1, "ab-") ~ "Airbnb",
           str_detect(..1, "cl-") ~ "Craigslist",
           str_detect(..1, "kj-") ~ "Kijiji")),
           subtitle = paste0('"', ..2, '"')) +
         theme_void() +
         theme(plot.title = element_text(face = "bold", size = 9),
               plot.subtitle = element_text(face = "plain", size = 9))}) |>  
  patchwork::wrap_plots()

```

As of the end of spring 2022 there are signs that Vancouver's commercial STR operators are retuning to the market. If the province's STR market returns to its pre-pandemic trajectory by the end of 2023, this would imply that there could be `r housing_loss_2023_V` housing units operating as dedicated STRs in Vancouver---a `r housing_loss_change_2021_2023_V` increase over the actual number as of the end of April 2022. This implies that STR activity will drive up average monthly rents by `r rent_inc_monthly_2021_2023_V` above their levels at the end of spring 2022. This is an extra `r rent_inc_annual_2021_2023_V` the average Vancouver renter household will be paying per year because of the growth of commercial STRs. Figure 19 shows the forecasted percentage and absolute rent increases which Vancouver renters will experience in 2023 if the quantity of commercial STRs returns to its pre-pandemic trend.

```{r fig_19, fig.width = 9}

rent_change_2023_table_V |> 
  left_join(filter(cmhc_str, year == 5)) |> 
  mutate(label = scales::dollar(str_2023, 1, prefix = "+$")) |> 
  st_as_sf() |> 
  ggplot() +
  geom_sf(data = CSD, colour = "transparent", fill = "grey80") +
  geom_sf(data = filter(CSD, name == "Vancouver"), fill = "grey90",
          colour = "transparent") +
  geom_sf(aes(fill = rent_2023_pct), colour = "white") +
  geom_sf(data = streets_V, colour = "#FFFFFF90") +
  geom_sf(data = streets_V_2, colour = "#FFFFFF80", lwd = 0.2) +
  geom_sf(data = water, fill = "white", colour = "transparent") +
  geom_sf_label(aes(label = label)) +
  coord_sf(xlim = st_bbox(filter(CSD, name == "Vancouver"))[c(1, 3)],
           ylim = st_bbox(filter(CSD, name == "Vancouver"))[c(2, 4)]) +
  scale_fill_viridis_b(name = "STR-induced monthly rent increase as % of expected 2023 rent",
                       limits = c(0.02, 0.06), n.breaks = 5, 
                       labels = scales::percent) +
  ggtitle("Projected 2023 STR-induced monthly rent increases in Vancouver") +
  theme_void() +
  theme(legend.position = "bottom")

```

## Victoria

The city of Victoria, the capital of British Columbia, has a population of 91,900. It is the 14th largest city in the province, although it sits at the centre of the province's second largest urban region. In April 2022 there were an average of `r active_apr_2022_VC` active STR listings in Victoria each day (a `r active_change_2021_2022_VC` year-over-year increase from April 2021, although still far lower than the `r active_avg_2019_VC` active in 2019). Over the course of 2021, Victoria's STR listings were operated by `r hosts_avg_2021_VC` hosts (compared to `r hosts_avg_2019_VC` in 2019), who collectively earned `r rev_total_2021_VC` in revenue (just half the `r rev_total_2019_VC` in 2019), with an average of `r rev_avg_2021_VC` per listing (compared to `r rev_avg_2019_VC` in 2019) and a median of `r rev_med_2021_VC` (compared to `r rev_med_2019_VC` in 2019).

Figure X displays the number of active listings per day in Victoria, expressed as a percentage of all dwelling units. Compared to the other two central-city municipalities in the largest urban regions in BC (Vancouver and Abbotsford), Richmond has persistently had a higher prevalence of STRs. While the gap narrowed in the early days of the pandemic, since 2021 Victoria's STR market has rebounded much more quickly than Vancouver's or Abbotsford's. Figure X shows the distribution of Victoria's STRs in 2021, as actual locations in the left panel and as a share of dwelling units in the right panel.

Since the pandemic, Victoria's STR market has collapsed---similarly to other municipalities in large urban regions in BC. As the left panel of Figure X demonstrates, STR reservations from March 2020 through April 2022 have been only `r covid_res_pct_VC` of what would have been expected for this time period. At the same time, the right panel of Figure X shows that, from the start of the pandemic through the end of 2021, nightly prices have been on average `r covid_price_pct_2021_VC` lower than the pre-pandemic trend. However, this situation has reversed itself in 2022, during which time nightly prices have been an average of `r covid_price_pct_2022_VC` _higher_ than the pre-pandemic trend. As subsequent case studies will make clear, Victoria has thus shifted from a pattern consistent with other large BC cities early in the pandemic—where international travel was cancelled and diverted to regional destinations, causing STR demand in the major cities to fall dramatically—to a pattern consistent with smaller tourism destinations—which saw low reservation volumes at high prices, as increased local tourism demand interacted with reduced STR supply.

Both before and during the pandemic, Victoria's STR market has been dominated by commercial operators. On average from 2018-2022, `r commercial_pct_VC` of listings active each day in Victoria have been frequently rented entire-home listings or ghost hostels, which means they are highly unlikely to be the host's principal residence. Figure X shows the total amount of STR-induced housing loss in Victoria, and demonstrates that, in the absence of the pandemic, there would likely be approximataley 800 housing units converted to full-time STRs in the city.

From 2016-2021, our province-wide model suggests that renters in Victoria paid `r overpaid_2016_2021_VC` more in rent because of the presence of commercial STRs driving up rents. In 2019, when the STR market was at its pre-pandemic peak, we estimate dedicated STRs were responsible for `r rent_str_pct_2019_VC` of the total rents paid by Victoria tenants. Put differently, during the 2017-2019 pre-pandemic period, the increase of dedicated STRs in Victoria accounts for an enormous `r str_incr_2017_2019_VC` of the increases in rents which Victoria households were subjected to. The average Victoria neighbourhood saw a `r rent_month_2017_2019_VC` increase in monthly rent each of these years, of which `r str_incr_month_2017_2019_VC` can be attributed to the growth of dedicated STRs.

In 2020, when the number of commercial STRs plummeted because of the pandemic, we estimate that rents increased `r str_incr_2020_V` less than they otherwise would have, because of the decrease in commercial STRs that year. But if the province's STR market returns to its pre-pandemic trajectory by the end of 2023, this would imply that there will be `r housing_loss_2023_VC` housing units operating as dedicated STRs in Victoria---a `r housing_loss_change_2021_2023_VC` increase over the actual number as of the end of spring 2022. This implies that STR activity will drive up average monthly rents by `r rent_inc_monthly_2021_2023_VC` above their levels at the end of spring 2022. This is an extra `r rent_inc_annual_2021_2023_VC` the average Richmond renter household will be paying per year because of the growth of commercial STRs. Figure X shows the forecasted percentage and absolute rent increases which Victoria renters will experience in 2023 if the quantity of commercial STRs returns to its pre-pandemic trend.


## Richmond

The city of Richmond, the third largest municipality in the Metro Vancouver region, has a population of 210,000. In April 2022 there were an average of `r active_apr_2022_R` active STR listings in Richmond each day (a `r active_change_2021_2022_R` year-over-year increase from April 2021, although still far lower than the `r active_avg_2019_R` active in 2019). Over the course of 2021, Richmond's STR listings were operated by `r hosts_avg_2021_R` hosts (compared to `r hosts_avg_2019_R` in 2019), who collectively earned `r rev_total_2021_R` in revenue (just half the `r rev_total_2019_R` in 2019), with an average of `r rev_avg_2021_R` per listing (compared to `r rev_avg_2019_R` in 2019) and a median of `r rev_med_2021_R` (compared to `r rev_med_2019_R` in 2019).

Figure X displays the number of active listings per day in Richmond, expressed as a percentage of all dwelling units. Compared to other non-core municipalities in the largest urban regions in BC, Richmond had a higher prevalence of STRs in 2019. Richmond's STR market also weathered the first year of the pandemic better than other municipalities in its category, but over the course of 2021 STR activity in Richmond stagnated at the same time as it began to recovery in other large-region municipalities. Figure X shows the distribution of these STRs in 2021, as actual locations in the left panel and as a share of dwelling units in the right panel.

```{r fig_R_1, echo = FALSE}

active_daily_R |> 
  ggplot() +
  geom_line(aes(date, n_pct, colour = group), lwd = 1.5) +
  scale_x_date(name = NULL) +
  scale_y_continuous(name = NULL, labels = scales::percent) +
  scale_colour_manual(name = NULL, values = c("grey30", "red"), 
                      na.value = "transparent") +
  ggtitle("Figure X. Active listings as % of all dwelling units") + 
  theme_minimal() +
  theme(legend.position = "bottom")

```

```{r fig_R_2, fig.width = 9}

fig_R_2_left <- 
  property_R |> 
  filter(created <= "2021-12-31", scraped >= "2021-01-01") |> 
  st_as_sf(coords = c("longitude", "latitude"), crs = 4326) |> 
  st_transform(32610) |> 
  ggplot() +
  geom_sf(data = CSD, colour = "transparent", fill = "grey80") +
  geom_sf(data = filter(CSD, name == "Richmond"), fill = "grey90",
          colour = "transparent") +
  geom_sf(data = streets_R, colour = "#FFFFFF90") +
  geom_sf(data = streets_R_2, colour = "#FFFFFF80", lwd = 0.2) +
  geom_sf(data = water, fill = "white", colour = "transparent") +
  geom_sf(aes(colour = listing_type), size = 0.5) +
  coord_sf(xlim = st_bbox(filter(CSD, name == "Richmond"))[c(1, 3)],
           ylim = st_bbox(filter(CSD, name == "Richmond"))[c(2, 4)]) +
  scale_colour_discrete(name = NULL) +
  theme_void() +
  theme(legend.position = "bottom")

fig_R_2_right <- 
  CT |> 
  inner_join(listings_pct_R) |> 
  ggplot() +
  geom_sf(data = CSD, colour = "transparent", fill = "grey80") +
  geom_sf(data = filter(CSD, name == "Richmond"), fill = "grey90", 
          colour = "transparent") +
  geom_sf(aes(fill = pct), colour = "white", size = 0.5) +
  geom_sf(data = streets_R, colour = "#FFFFFF90") +
  geom_sf(data = streets_R_2, colour = "#FFFFFF80", lwd = 0.2) +
  geom_sf(data = water, fill = "white", colour = "transparent") +
  scale_fill_viridis_b(name = "Active STR listings as % of dwelling units",
                       labels = scales::percent, n.breaks = 8) +
  coord_sf(xlim = st_bbox(filter(CSD, name == "Richmond"))[c(1, 3)],
           ylim = st_bbox(filter(CSD, name == "Richmond"))[c(2, 4)]) +
  theme_void() +
  theme(legend.position = "bottom")

fig_R_2_left + fig_R_2_right + ggtitle("Figure X. Active STR listings in Richmond")

```

Since the pandemic, Richmond's STR market has collapsed---similarly to other municipalities in large urban regions in BC. As the left panel of Figure X demonstrates, STR reservations from March 2020 through March 2022 have been only `r covid_res_pct_R` of what would have been expected for this time period. At the same time, the right panel of Figure X shows that, after a brief dip at the beginning of the pandemic, average nightly prices have been `r covid_price_pct_R` lower than the pre-pandemic trend. This combination of fewer reservations at lower prices demonstrates a collapse in STR demand in Richmond, and is consistent with the pattern we have observed provincially, where international travel was cancelled and diverted to regional destinations, causing STR demand in the major cities to fall dramatically.

```{r fig_R_3, fig.width = 9}

p1 <- reservations_and_prices_R |> 
  mutate(res = slide_dbl(res, mean, .before = 6, .complete = TRUE)) |> 
  mutate(res_trend = if_else(date <= "2020-03-01", NA_real_, res_trend)) |> 
  select(date, res, res_trend) |> 
  pivot_longer(-c(date)) |> 
  filter(!is.na(value)) |> 
  mutate(label = case_when(
    date == "2019-07-05" & name == "res" ~ "Actual reservations", 
    date == "2020-08-05" & name == "res_trend" ~ "Expected reservations",
    TRUE ~ NA_character_)) |> 
  ggplot() +
  geom_ribbon(aes(x = date, ymin = res, ymax = res_trend, group = 1),
              data = {reservations_and_prices_R |> 
                  mutate(res = slider::slide_dbl(res, mean, .before = 6, .complete = TRUE)) |> 
                  mutate(res_trend = if_else(date <= "2020-03-01", NA_real_, res_trend))
                }, fill = col_palette[3],
              alpha = 0.3) +
  geom_line(aes(date, value, color = name), lwd = 1) +
  geom_label(aes(date, value, label = label, color = name), size = 3) +
  scale_x_date(name = NULL, limits = as.Date(c("2018-01-01", NA))) +
  scale_y_continuous(name = NULL, limits = c(0, NA), 
                     label = scales::comma) +
  scale_color_manual(name = NULL, 
                     labels = c("Actual reservations", "Expected reservations"), 
                     values = col_palette[c(5, 1)]) +
  theme_minimal() +
  theme(legend.position = "none",
        panel.grid.minor.x = element_blank(),
        plot.background = element_rect(fill = "white", colour = "transparent"))

p2 <- reservations_and_prices_R |> 
  mutate(price = slide_dbl(price, mean, .before = 6, .complete = TRUE)) |> 
  select(date, price, price_trend) |> 
  pivot_longer(-c(date)) |> 
  filter(!is.na(value)) |> 
  mutate(label = case_when(
    date == "2019-07-05" & name == "price" ~ "Actual price", 
    date == "2021-02-01" & name == "price_trend" ~ "Expected price",
    TRUE ~ NA_character_)) |> 
  ggplot() +
  geom_ribbon(aes(x = date, ymin = price, ymax = price_trend, group = 1),
              data = {reservations_and_prices_R |> 
                  mutate(price = slider::slide_dbl(price, mean, .before = 6, 
                                                   .complete = TRUE))}, 
              fill = col_palette[3],
              alpha = 0.3) +
  geom_line(aes(date, value, color = name), lwd = 1) +
  geom_label(aes(date, value, label = label, color = name), size = 3) +
  scale_x_date(name = NULL, limits = as.Date(c("2018-01-01", NA))) +
  scale_y_continuous(name = NULL, label = scales::dollar) +
  scale_color_manual(name = NULL, 
                     labels = c("Actual price", "Expected price"), 
                     values = col_palette[c(5, 1)]) +
  theme_minimal() +
  theme(legend.position = "none",
        panel.grid.minor.x = element_blank(),
        plot.background = element_rect(fill = "white", colour = "transparent"))

p1 + p2

```

Both before and during the pandemic, commercial operators have been ubiquitous in Richmond's STR market. On average from 2018-2021, `r commercial_pct_R` of listings active each day in Richmond have been frequently rented entire-home listings or ghost hostels, which means they are highly unlikely to be the host's principal residence. Figure X shows the total amount of STR-induced housing loss in Richmond, and demonstrates that, in the absence of the pandemic, there would likely be nearly 600 housing units converted to full-time STRs in the city.

```{r fig_R_4, fig.width = 9}

dat <- 
  housing_loss_daily_model_R |> 
  mutate(units_trend = slide_dbl(units_trend, mean, .before = 6, .complete = TRUE)) |>
  select(date, units, units_trend) |> 
  filter(date <= "2022-03-31")

dat |> 
  pivot_longer(-c(date)) |> 
  filter(!is.na(value)) |> 
  mutate(label = case_when(
    date == "2019-05-05" & name == "units" ~ "Actual housing loss", 
    date == "2020-03-07" & name == "units_trend" ~ "Expected housing loss",
    TRUE ~ NA_character_)) |> 
  ggplot() +
  geom_ribbon(aes(x = date, ymin = units, ymax = units_trend, group = 1),
              data = dat, fill = col_palette[3], alpha = 0.3) +
  geom_line(aes(date, value, color = name), lwd = 1) +
  geom_label(aes(date, value, label = label, color = name), size = 3) +
  scale_x_date(name = NULL, limits = as.Date(c("2018-01-01", NA))) +
  scale_y_continuous(name = NULL, limits = c(0, NA), 
                     label = scales::comma) +
  scale_color_manual(name = NULL, 
                     labels = c("Actual STR housing loss", 
                                "Expected STR housing loss"), 
                     values = col_palette[c(5, 1)]) +
  theme_minimal() +
  theme(legend.position = "none",
        panel.grid.minor.x = element_blank(),
        plot.background = element_rect(fill = "white", colour = "transparent"))

```

From 2016-2021, our province-wide model suggests that renters in Richmond paid `r overpaid_2016_2021_R` more in rent because of the presence of commercial STRs driving up rents. In 2019, when the STR market was at its pre-pandemic peak, we estimate dedicated STRs were responsible for `r rent_str_pct_2019_R` of the total rents paid by Richmond tenants. Put differently, during the 2017-2019 pre-pandemic period, the increase of dedicated STRs in Richmond accounts for `r str_incr_2017_2019_R` of the increases in rents which Richmond households were subjected to. The average Richmond neighbourhood saw a `r rent_month_2017_2019_R` increase in monthly rent each of these years, of which `r str_incr_month_2017_2019_R` can be attributed to the growth of dedicated STRs.

In 2020, when the number of commercial STRs plummeted because of the pandemic, we estimate that rents increased `r str_incr_2020_R` less than they otherwise would have, because of the decrease in commercial STRs that year. But if the province's STR market returns to its pre-pandemic trajectory by the end of 2023, this would imply that there will be `r housing_loss_2023_R` housing units operating as dedicated STRs in Richmond---a `r housing_loss_change_2021_2023_R` increase over the actual number as of the end of 2021. This implies that STR activity will drive up average monthly rents by `r rent_inc_monthly_2021_2023_R` above their levels at the end of 2021. This is an extra `r rent_inc_annual_2021_2023_R` the average Richmond renter household will be paying per year because of the growth of commercial STRs. Figure X shows the forecasted percentage and absolute rent increases which Richmond renters will experience in 2023 if the quantity of commercial STRs returns to its pre-pandemic trend.

```{r fig_R_5, fig.width = 9}

rent_change_2023_table_R |> 
  left_join(filter(cmhc_str, year == 5)) |> 
  mutate(label = scales::dollar(str_2023, 1, prefix = "+$")) |> 
  st_as_sf() |> 
  ggplot() +
  geom_sf(data = CSD, colour = "transparent", fill = "grey80") +
  geom_sf(data = filter(CSD, name == "Richmond"), fill = "grey90",
          colour = "transparent") +
  geom_sf(aes(fill = rent_2023_pct), colour = "white") +
  geom_sf(data = streets_R, colour = "#FFFFFF90") +
  geom_sf(data = streets_R_2, colour = "#FFFFFF80", lwd = 0.2) +
  geom_sf(data = water, fill = "white", colour = "transparent") +
  geom_sf_label(aes(label = label)) +
  coord_sf(xlim = st_bbox(filter(CSD, name == "Richmond"))[c(1, 3)],
           ylim = st_bbox(filter(CSD, name == "Richmond"))[c(2, 4)]) +
  scale_fill_viridis_b(name = "STR-induced rent increase as % of expected 2023 rent",
                       limits = c(0.02, 0.06), n.breaks = 5, 
                       labels = scales::percent) +
  ggtitle("Projected 2023 STR-induced rent increases in Richmond") +
  theme_void() +
  theme(legend.position = "bottom")

```

## Nanaimo

The city of Nanaimo, on the eastern coast of Vancouver Island, has a population of just under 100,000. In April 2022 there were an average of `r active_apr_2022_N` active STR listings in Nanaimo each day (a `r active_change_2021_2022_N` year-over-year increase from April 2021, although still far lower than the `r active_avg_2019_N` active in 2019). Over the course of 2021, Nanaimo's STR listings were operated by `r hosts_avg_2021_N` hosts (compared to `r hosts_avg_2019_N` in 2019), who collectively earned `r rev_total_2021_N` in revenue (just half the `r rev_total_2019_N` in 2019), with an average of `r rev_avg_2021_N` per listing (compared to `r rev_avg_2019_N` in 2019) and a median of `r rev_med_2021_N` (compared to `r rev_med_2019_N` in 2019).

Figure X displays the number of active listings per day in Nanaimo, expressed as a percentage of all dwelling units. Compared to other mid-sized cities in BC, Nanaimo has a lower-than-average number of active STRs, and this gap has widened slightly during 2021, as other mid-sized cities have seen their STR markets recover faster than Nanaimo. Figure X shows the distribution of these STRs in 2021, in the left panel as actual listing locations and in the right panel as a proportion of all dwelling units.

Since the pandemic, Nanaimo's STR market has followed a similar trajectory to other communities which receive significant tourism flows from within BC. As the left panel of Figure X demonstrates, STR reservations from March 2020 through March 2022 have been only `r covid_res_pct_N` of what would have been expected for this time period. But, at the same time, the right panel of Figure X shows that, after a brief dip at the beginning of the pandemic, average nightly prices have been elevated `r covid_price_pct_N` over their pre-pandemic trend in Nanaimo. This combination of fewer reservations at higher prices is consistent with the pattern we have observed provincially, where international travel was cancelled and diverted to regional destinations, causing STR demand outside the major cities to remain reasonable strong, while supply constraints led that demand to manifest as higher prices rather than more listings.

Both before and during the pandemic, Nanaimo's STR market has been dominated by commercial operators. On average from 2018-2021, `r commercial_pct_N` of listings active each day in Nanaimo have been frequently rented entire-home listings or ghost hostels, which means they are highly unlikely to be the host's principal residence. Figure X shows the total amount of STR-induced housing loss in Nanaimo, and demonstrates that, in the absence of the pandemic, there would likely be more than 200 housing units converted to full-time STRs in the city.

From 2016-2021, our province-wide model suggests that renters in Nanaimo paid `r overpaid_2016_2021_N` more in rent because of the presence of commercial STRs driving up rents. In 2019, when the STR market was at its pre-pandemic peak, we estimate dedicated STRs were responsible for `r rent_str_pct_2019_N` of the total rents paid by Nanaimo tenants. Put differently, during the 2017-2019 pre-pandemic period, the increase of dedicated STRs in Nanaimo accounts for `r str_incr_2017_2019_N` of the increases in rents which Nanaimo households were subjected to. The average Nanaimo neighbourhood saw a `r rent_month_2017_2019_N` increase in monthly rent each of these years, of which `r str_incr_month_2017_2019_N` can be attributed to the growth of dedicated STRs.

In 2020, when the number of commercial STRs plummeted because of the pandemic, we estimate that rents increased `r str_incr_2020_N` less than they otherwise would have, because of the decrease in commercial STRs that year. But if the province's STR market returns to its pre-pandemic trajectory by the end of 2023, this would imply that there will be `r housing_loss_2023_N` housing units operating as dedicated STRs in Nanaimo---a `r housing_loss_change_2021_2023_N` increase over the actual number as of the end of 2021. This implies that STR activity will drive up average monthly rents by `r rent_inc_monthly_2021_2023_N` above their levels at the end of 2021. This is an extra `r rent_inc_annual_2021_2023_N` the average Nanaimo renter household will be paying per year because of the growth of commercial STRs.


## Parksville Qualicum Beach

The cities of Parksville and Qualicum Beach are located ten kilometres away from each other on the eastern side of Vancouver Island. Along with the stretch of the Regional District of Nanaimo which lies between them, they have a population of 31,000. In April 2022 there were an average of `r active_apr_2022_PQ` active STR listings in Parksville Qualicum Beach each day (a `r active_change_2021_2022_PQ` year-over-year increase from April 2021, although still significantly lower than the `r active_avg_2019_PQ` active in 2019). Over the course of 2021, Parksville Qualicum Beach's STR listings were operated by `r hosts_avg_2021_PQ` hosts (compared to `r hosts_avg_2019_PQ` in 2019), who collectively earned `r rev_total_2021_PQ` in revenue (almost exactly the `r rev_total_2019_PQ` in 2019), with an average of `r rev_avg_2021_PQ` per listing (compared to `r rev_avg_2019_PQ` in 2019) and a median of `r rev_med_2021_PQ` (compared to `r rev_med_2019_PQ` in 2019).

Figure X displays the number of active listings per day in Parksville Qualicum Beach, expressed as a percentage of all dwelling units. Compared to other mid-sized cities in BC, Parksville Qualicum Beach has a much higher-than-average number of active STRs. Figure X shows the distribution of these STRs in 2021.

Since the pandemic, Parksville Qualicum Beach's STR market has followed a similar trajectory to other communities which receive significant tourism flows from within BC. As the left panel of Figure X demonstrates, STR reservations from March 2020 through March 2022 have been only `r covid_res_pct_N` of what would have been expected for this time period. But, at the same time, the centre panel of Figure X shows that average nightly prices have been elevated `r covid_price_pct_N` over their pre-pandemic trend in Parksville Qualicum Beach. This combination of fewer reservations at higher prices is consistent with the pattern we have observed provincially, where international travel was cancelled and diverted to regional destinations, causing STR demand outside the major cities to remain reasonable strong, while supply constraints led that demand to manifest as higher prices rather than more listings.

Both before and during the pandemic, Parksville Qualicum Beach's STR market has been dominated by commercial operators. On average from 2018-2021, `r commercial_pct_N` of listings active each day in Parksville Qualicum Beach have been frequently rented entire-home listings or ghost hostels, which means they are highly unlikely to be the host's principal residence. Figure X shows the total amount of STR-induced housing loss in Parksville Qualicum Beach, and demonstrates that, in the absence of the pandemic, there would likely be more than 150 housing units converted to full-time STRs in the city.

From 2016-2021, our province-wide model suggests that renters in Parksville Qualicum Beach paid `r overpaid_2016_2021_N` more in rent because of the presence of commercial STRs driving up rents. In 2019, when the STR market was at its pre-pandemic peak, we estimate dedicated STRs were responsible for `r rent_str_pct_2019_N` of the total rents paid by Nanaimo tenants. Put differently, during the 2017-2019 pre-pandemic period, the increase of dedicated STRs in Parksville Qualicum Beach accounts for `r str_incr_2017_2019_N` of the increases in rents which Nanaimo households were subjected to. The average Parksville Qualicum Beach neighbourhood saw a `r rent_month_2017_2019_N` increase in monthly rent each of these years, of which `r str_incr_month_2017_2019_N` can be attributed to the growth of dedicated STRs.

In 2020, when the number of commercial STRs plummeted because of the pandemic, we estimate that rents increased `r str_incr_2020_N` less than they otherwise would have, because of the decrease in commercial STRs that year. But if the province's STR market returns to its pre-pandemic trajectory by the end of 2023, this would imply that there will be `r housing_loss_2023_N` housing units operating as dedicated STRs in Parksville Qualicum Beach---a `r housing_loss_change_2021_2023_N` increase over the actual number as of the end of 2021. This implies that STR activity will drive up average monthly rents by `r rent_inc_monthly_2021_2023_N` above their levels at the end of 2021. This is an extra `r rent_inc_annual_2021_2023_N` the average Nanaimo renter household will be paying per year because of the growth of commercial STRs.


## Kelowna

The city of Kelowna, which has a population of 145,000, lies at the heart of the tourist economy of the Okanagan Valley. In April 2022 there were an average of `r active_apr_2022_K` active STR listings in Kelowna each day (a `r active_change_2021_2022_K` year-over-year increase from April 2021, although still significantly lower than the `r active_avg_2019_K` active in 2019). Over the course of 2021, Kelowna's STR listings were operated by listings were operated by `r hosts_avg_2021_K` hosts (compared to `r hosts_avg_2019_K` in 2019), who collectively earned `r rev_total_2021_K` in revenue (almost exactly equal to the `r rev_total_2019_K` in 2019, despite the much smaller number of active listings), with an average of `r rev_avg_2021_K` per listing (compared to `r rev_avg_2019_K` in 2019) and a median of `r rev_med_2021_K` (compared to `r rev_med_2019_K` in 2019).

Figure X displays the number of active listings per day in Kelowna, expressed as a percentage of all dwelling units. Compared to other resort municipalities, Kelowna has persistently had a lower prevalence of STRs, and this pattern has continued since the pandemic. (At the same time, Kelowna has a far higher prevalence of STRs than nearly any non-resort municipality in the province; it is only in relation to other resort towns that it is below average.) Figure X shows the distribution of these STRs in 2021, as actual locations in the left panel and as a share of dwelling units in the right panel.

Since the pandemic, Kelowna's STR market has seen low reservation counts but high prices, which is a pattern it shares with other tourist communities in the province. As the left panel of Figure X demonstrates, STR reservations from March 2020 through March 2022 have been only `r covid_res_pct_K` of what would have been expected for this time period. At the same time, the right panel of Figure X shows that, after a brief dip at the beginning of the pandemic, average nightly prices have been `r covid_price_pct_K` higher than the pre-pandemic trend, with a particularly noteworthy spike during the summer high season in 2021, when prices were `r covid_price_pct_2021_K` higher than the pre-pandemic trend. This combination of fewer reservations at higher prices is consistent with the pattern we have observed provincially, where international travel was cancelled and diverted to regional destinations, causing STR demand outside the major cities to remain reasonable strong, while supply constraints led that demand to manifest as higher prices rather than more listings.

Both before and during the pandemic, Kelowna's STR market has been dominated by commercial operators. On average from 2018-2021, `r commercial_pct_K` of listings active each day in Kelowna have been frequently rented entire-home listings or ghost hostels, which means they are highly unlikely to be the host's principal residence. Figure X shows the total amount of STR-induced housing loss in Kelowna, and demonstrates that, in the absence of the pandemic, there would likely be nearly 800 housing units converted to full-time STRs in the city.

From 2016-2021, our province-wide model suggests that renters in Kelowna and its surroundings (specifically, the CMHC-defined "Core Area" zone of the Regional District of Central Okanagan) paid `r overpaid_2016_2021_K` more in rent because of the presence of commercial STRs driving up rents. This is the second highest of any municipality in the province (behind Vancouver), despite Kelowna's relatively modest population. In 2019, when the STR market was at its pre-pandemic peak, we estimate dedicated STRs were responsible for `r rent_str_pct_2019_K` of the total rents paid by Kelowna tenants. Put differently, during the 2017-2019 pre-pandemic period, the increase of dedicated STRs in Kelowna accounts for a shocking `r str_incr_2017_2019_K` of the increases in rents which Kelowna households were subjected to. The average Kelowna neighbourhood saw a `r rent_month_2017_2019_K` increase in monthly rent each of these years, of which `r str_incr_month_2017_2019_K` can be attributed to the growth of dedicated STRs.

In 2020, when the number of commercial STRs declined because of the pandemic, we estimate that rents increased `r str_incr_2020_K` less than they otherwise would have, because of the decrease in commercial STRs that year. But if the province's STR market returns to its pre-pandemic trajectory by the end of 2023, this would imply that there will be `r housing_loss_2023_K` housing units operating as dedicated STRs in Kelowna---a `r housing_loss_change_2021_2023_K` increase over the actual number as of the end of 2021. This implies that STR activity will drive up average monthly rents by `r rent_inc_monthly_2021_2023_K` above their levels at the end of 2021. This is an extra `r rent_inc_annual_2021_2023_K` the average Kelowna renter household will be paying per year because of the growth of commercial STRs.


## Revelstoke

The city of Revelstoke, which has a population of 8,300, is located in southeast British Columbia, and has become a major skiing destination since the opening of the Revelstoke Mountain Resort in 2007. In April 2022 there were an average of `r active_apr_2022_RS` active STR listings in Revelstoke each day (a `r active_change_2021_2022_RS` year-over-year increase from April 2021, although still significantly lower than the `r active_avg_2019_RS` active in 2019). Over the course of 2021, Revelstoke's STR listings were operated by listings were operated by `r hosts_avg_2021_RS` hosts (compared to `r hosts_avg_2019_RS` in 2019), who collectively earned `r rev_total_2021_RS` in revenue (somewhat less than the `r rev_total_2019_RS` in 2019), with an average of `r rev_avg_2021_RS` per listing (compared to `r rev_avg_2019_RS` in 2019) and a median of `r rev_med_2021_RS` (compared to `r rev_med_2019_RS` in 2019).

Figure X displays the number of active listings per day in Revelstoke, expressed as a percentage of all dwelling units. Compared to other resort municipalities, Revelstoke has persistently had a higher prevalence of STRs, and this pattern has continued since the pandemic, despite a disproportionately large fall in STR activity at the beginning of the pandemic. Figure X shows the distribution of these STRs in 2021.

Since the pandemic, Revelstoke's STR market has seen low reservation counts but high prices, which is a pattern it shares with other tourist communities in the province. As the left panel of Figure X demonstrates, STR reservations from March 2020 through April 2022 have been only `r covid_res_pct_RS` of what would have been expected for this time period. At the same time, the right panel of Figure X shows that, after a brief dip at the beginning of the pandemic, average nightly prices have been `r covid_price_pct_RS` higher than the pre-pandemic trend, with a particularly noteworthy spike since the beginning of 2022, when prices have been `r covid_price_pct_2022_RS` higher than the pre-pandemic trend. This combination of fewer reservations at higher prices is consistent with the pattern we have observed provincially, where international travel was cancelled and diverted to regional destinations, causing STR demand outside the major cities to remain reasonable strong, while supply constraints led that demand to manifest as higher prices rather than more listings.

Both before and during the pandemic, Revelstoke's STR market has been dominated by commercial operators. On average from 2018-2021, `r commercial_pct_RS` of listings active each day in Revelstoke have been frequently rented entire-home listings or ghost hostels, which means they are highly unlikely to be the host's principal residence. Figure X shows the total amount of STR-induced housing loss in Kelowna, and demonstrates that housing loss is rapidly catching up to its pre-pandemic trend. In the absence of the pandemic, there would likely be approximately 175 housing units converted to full-time STRs in the city.


## Fernie

The city of Fernie, which has a population of 6,300, is located in southeast British Columbia, and is a popular BC and Alberta winter tourism destination. In April 2022 there were an average of `r active_apr_2022_F` active STR listings in Fernie each day (a `r active_change_2021_2022_F` year-over-year increase from April 2021, although still significantly lower than the `r active_avg_2019_F` active in 2019). Over the course of 2021, Fernie's STR listings were operated by `r hosts_avg_2021_F` hosts (compared to `r hosts_avg_2019_F` in 2019), who collectively earned `r rev_total_2021_F` in revenue (somewhat less than the `r rev_total_2019_F` in 2019), with an average of `r rev_avg_2021_F` per listing (compared to `r rev_avg_2019_F` in 2019) and a median of `r rev_med_2021_F` (compared to `r rev_med_2019_F` in 2019).

Figure X displays the number of active listings per day in Fernie, expressed as a percentage of all dwelling units. Compared to other resort municipalities, Fernie has persistently had a higher prevalence of STRs, and this pattern has continued since the pandemic, despite a disproportionately large fall in STR activity at the beginning of the pandemic, when Fernie's STR prevalence nearly reached the resort municipality average. Since late 2020, by contrast, STR activity has grown much faster in Fernie than in other resort towns. Figure X shows the spatial distribution of Fernie's STRs in 2021.

Since the pandemic, Fernie's STR market has seen low reservation counts and low prices, which is a pattern that sets it apart from other tourist communities in the province. As the left panel of Figure X demonstrates, STR reservations from March 2020 through April 2022 have been only `r covid_res_pct_F` of what would have been expected for this time period. At the same time, the centre panel of Figure X shows that average nightly prices have been `r covid_price_pct_F` lower than the pre-pandemic trend. This combination of fewer reservations at lower prices indicates a pandemic-induced collapse in demand for STRs in Fernie, although STR activity has been growing robustly through 2021 and 2022, and prices have more recently begun to recover as well.

Both before and during the pandemic, Fernie's STR market has been dominated by commercial operators. On average from 2018-2021, `r commercial_pct_F` of listings active each day in Fernie have been frequently rented entire-home listings or ghost hostels, which means they are highly unlikely to be the host's principal residence. Figure X shows the total amount of STR-induced housing loss in Fernie, and demonstrates that housing units are being steadily reconverted to dedicated STRs, albeit not yet at a rate which will implies a catch-up to the pre-pandemic trend.In the absence of the pandemic, there would likely be more than 150 housing units converted to full-time STRs in the city.


## Summerland

Summerland, a town of 12,000 people, is located on the west side of Okanagan Lake, near Kelowna. In April 2022 there were an average of `r active_apr_2022_S` active STR listings in Summerland each day (a `r active_change_2021_2022_S` year-over-year increase from April 2021, although still significantly lower than the `r active_avg_2019_S` active in 2019). Over the course of 2021, Summerland's STR listings were operated by `r hosts_avg_2021_S` hosts (compared to `r hosts_avg_2019_S` in 2019), who collectively earned `r rev_total_2021_S` in revenue (substantially higher than the `r rev_total_2019_S` in 2019, despite the much smaller number of active listings), with an average of `r rev_avg_2021_S` per listing (compared to `r rev_avg_2019_S` in 2019) and a median of `r rev_med_2021_S` (compared to `r rev_med_2019_S` in 2019).

Figure X displays the number of active listings per day in Summerland, expressed as a percentage of all dwelling units. Compared to other non-urban communities in BC, Summerland has generally had a somewhat higher prevalence of STRs, albeit with stronger seasonal spikes---reflecting the town's status as a popular summer tourist destination. (Although the low listing counts in many non-urban communities makes the comparison a somewhat noisy one.) Figure X shows the distribution of these STRs in 2021.

```{r fig_S_1, echo = FALSE}

active_daily_S |> 
  ggplot() +
  geom_line(aes(date, n_pct, colour = group), lwd = 1.5) +
  scale_x_date(name = NULL) +
  scale_y_continuous(name = NULL, labels = scales::percent) +
  scale_colour_manual(name = NULL, values = c("grey30", "red"), 
                      na.value = "transparent") +
  ggtitle("Figure X. Active listings as % of all dwelling units") + 
  theme_minimal() +
  theme(legend.position = "bottom")

```

```{r fig_S_2, fig.width = 9}

property_S |> 
  filter(created <= "2021-12-31", scraped >= "2021-01-01") |> 
  st_as_sf(coords = c("longitude", "latitude"), crs = 4326) |> 
  st_transform(32610) |> 
  ggplot() +
  geom_sf(data = CSD, colour = "transparent", fill = "grey80") +
  geom_sf(data = filter(CSD, name == "Summerland"), fill = "grey90",
          colour = "transparent") +
  geom_sf(data = streets_S, colour = "#FFFFFF90") +
  geom_sf(data = streets_S_2, colour = "#FFFFFF80", lwd = 0.2) +
  geom_sf(data = water, fill = "white", colour = "transparent") +
  geom_sf(aes(colour = listing_type), size = 0.5) +
  coord_sf(xlim = st_bbox(filter(CSD, name == "Summerland"))[c(1, 3)],
           ylim = st_bbox(filter(CSD, name == "Summerland"))[c(2, 4)]) +
  scale_colour_discrete(name = NULL) +
  ggtitle("Figure X. Active STR listings in Summerland") +
  theme_void() +
  theme(legend.position = "bottom")

```

Since the pandemic, Summerland's STR market has seen low reservation counts but steady prices, in which respect it somewhat resembles dedicated resort towns in the province. As the left panel of Figure X demonstrates, STR reservations from March 2020 through March 2022 have been only `r covid_res_pct_S` of what would have been expected for this time period. At the same time, the right panel of Figure X shows that average nightly prices have been slightly (`r covid_price_pct_S`) higher than the pre-pandemic trend, with prices actually `r covid_price_pct_2021_S` higher than the pre-pandemic trend during the 2021 summer high season. This combination of fewer reservations at higher prices is consistent with the pattern we have observed provincially, where international travel was cancelled and diverted to regional destinations, causing STR demand outside the major cities to remain reasonable strong, while supply constraints led that demand to manifest as higher prices rather than more listings.

```{r fig_S_3, fig.width = 9}

p1 <- reservations_and_prices_S |> 
  mutate(res = slide_dbl(res, mean, .before = 6, .complete = TRUE)) |> 
  mutate(res_trend = if_else(date <= "2020-03-01", NA_real_, res_trend)) |> 
  select(date, res, res_trend) |> 
  pivot_longer(-c(date)) |> 
  filter(!is.na(value)) |> 
  mutate(label = case_when(
    date == "2019-07-05" & name == "res" ~ "Actual reservations", 
    date == "2020-08-05" & name == "res_trend" ~ "Expected reservations",
    TRUE ~ NA_character_)) |> 
  ggplot() +
  geom_ribbon(aes(x = date, ymin = res, ymax = res_trend, group = 1),
              data = {reservations_and_prices_S |> 
                  mutate(res = slider::slide_dbl(res, mean, .before = 6, .complete = TRUE)) |> 
                  mutate(res_trend = if_else(date <= "2020-03-01", NA_real_, res_trend))
                }, fill = col_palette[3],
              alpha = 0.3) +
  geom_line(aes(date, value, color = name), lwd = 1) +
  geom_label(aes(date, value, label = label, color = name), size = 3) +
  scale_x_date(name = NULL, limits = as.Date(c("2018-01-01", NA))) +
  scale_y_continuous(name = NULL, limits = c(0, NA), 
                     label = scales::comma) +
  scale_color_manual(name = NULL, 
                     labels = c("Actual reservations", "Expected reservations"), 
                     values = col_palette[c(5, 1)]) +
  theme_minimal() +
  theme(legend.position = "none",
        panel.grid.minor.x = element_blank(),
        plot.background = element_rect(fill = "white", colour = "transparent"))

p2 <- reservations_and_prices_S |> 
  mutate(price = slide_dbl(price, mean, .before = 6, .complete = TRUE)) |> 
  select(date, price, price_trend) |> 
  pivot_longer(-c(date)) |> 
  filter(!is.na(value)) |> 
  mutate(label = case_when(
    date == "2019-07-05" & name == "price" ~ "Actual price", 
    date == "2021-02-01" & name == "price_trend" ~ "Expected price",
    TRUE ~ NA_character_)) |> 
  ggplot() +
  geom_ribbon(aes(x = date, ymin = price, ymax = price_trend, group = 1),
              data = {reservations_and_prices_S |> 
                  mutate(price = slider::slide_dbl(price, mean, .before = 6, 
                                                   .complete = TRUE))}, 
              fill = col_palette[3],
              alpha = 0.3) +
  geom_line(aes(date, value, color = name), lwd = 1) +
  geom_label(aes(date, value, label = label, color = name), size = 3) +
  scale_x_date(name = NULL, limits = as.Date(c("2018-01-01", NA))) +
  scale_y_continuous(name = NULL, label = scales::dollar) +
  scale_color_manual(name = NULL, 
                     labels = c("Actual price", "Expected price"), 
                     values = col_palette[c(5, 1)]) +
  theme_minimal() +
  theme(legend.position = "none",
        panel.grid.minor.x = element_blank(),
        plot.background = element_rect(fill = "white", colour = "transparent"))

p1 + p2

```

Both before and during the pandemic, Summerland's STR market has been dominated by commercial operators. On average from 2018-2021, `r commercial_pct_S` of listings active each day in Summerland have been frequently rented entire-home listings or ghost hostels, which means they are highly unlikely to be the host's principal residence. Figure X shows the total amount of STR-induced housing loss in Summerland, and demonstrates that, in the absence of the pandemic, there would likely be nearly 80 housing units converted to full-time STRs in the city.

```{r fig_S_4, fig.width = 9}

dat <- 
  housing_loss_daily_model_S |> 
  mutate(units_trend = slide_dbl(units_trend, mean, .before = 6, .complete = TRUE)) |>
  select(date, units, units_trend) |> 
  filter(date <= "2022-03-31")

dat |> 
  pivot_longer(-c(date)) |> 
  filter(!is.na(value)) |> 
  mutate(label = case_when(
    date == "2019-05-05" & name == "units" ~ "Actual housing loss", 
    date == "2020-03-07" & name == "units_trend" ~ "Expected housing loss",
    TRUE ~ NA_character_)) |> 
  ggplot() +
  geom_ribbon(aes(x = date, ymin = units, ymax = units_trend, group = 1),
              data = dat, fill = col_palette[3], alpha = 0.3) +
  geom_line(aes(date, value, color = name), lwd = 1) +
  geom_label(aes(date, value, label = label, color = name), size = 3) +
  scale_x_date(name = NULL, limits = as.Date(c("2018-01-01", NA))) +
  scale_y_continuous(name = NULL, limits = c(0, NA), 
                     label = scales::comma) +
  scale_color_manual(name = NULL, 
                     labels = c("Actual STR housing loss", 
                                "Expected STR housing loss"), 
                     values = col_palette[c(5, 1)]) +
  theme_minimal() +
  theme(legend.position = "none",
        panel.grid.minor.x = element_blank(),
        plot.background = element_rect(fill = "white", colour = "transparent"))

```

From 2016-2021, our province-wide model suggests that renters in Summerland paid `r overpaid_2016_2021_S` more in rent because of the presence of commercial STRs driving up rents. In 2019, when the STR market was at its pre-pandemic peak, the model implies that dedicated STRs were responsible for `r rent_str_pct_2019_S` of the total rents paid by Summerland tenants. In fact, based on the observed province-wide relationship between the growth of STRs and changes in average rents, the model suggests that rents in Summerland would have *declined* between 2017-2019 if it hadn't been for the rapid conversion of housing units to dedicated STRs which occurred during this period. The average Summerland neighbourhood saw a `r rent_month_2017_2019_S` increase in monthly rent each of these years, and the model estimates that dedicated STRs drove up rents by `r str_incr_month_2017_2019_S`.

In 2020, when the growth in commercial STRs stalled because of the pandemic, we estimate that rents only increased `r str_incr_2020_S` due to STR growth that year. But if the province's STR market returns to its pre-pandemic trajectory by the end of 2023, this would imply that there will be `r housing_loss_2023_S` housing units operating as dedicated STRs in Summerland---a `r housing_loss_change_2021_2023_S` increase over the actual number as of the end of 2021. This implies that STR activity will drive up average monthly rents by `r rent_inc_monthly_2021_2023_S` above their levels at the end of 2021. This is an extra `r rent_inc_annual_2021_2023_S` the average Summerland renter household will be paying per year because of the growth of commercial STRs. To be clear, Summerland is a small enough community that extrapolating from province-wide models is an error prone procedure, and these numbers should be interpreted as extremely rough estimates. But the facts are clear: commercial STRs have had a significant negative impact on housing affordability in Summerland, and, if the commercial STR market is permitted to return to its pre-pandemic trend, this impact will be substantially exacerbated.
